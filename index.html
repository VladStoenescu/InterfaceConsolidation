<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interface Consolidation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="lib/xlsx.full.min.js"></script>
    <script src="lib/pptxgen.bundle.js"></script>
</head>
<body>
    <!-- Theme Toggle -->
    <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
    </button>
    
    <!-- Loading Spinner -->
    <div class="spinner-backdrop" id="spinnerBackdrop"></div>
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>
    
    <div class="container">
        <div class="header-badge">
            <span class="badge-dot"></span>
            <span>Premium Interface Visualization</span>
        </div>
        <h1>Interface Consolidation Tool</h1>
        <p class="description">Upload an Excel file to visualize system interfaces</p>
        
        <!-- View Navigation -->
        <div class="view-navigation">
            <button class="nav-btn active" onclick="switchView('network')" data-view="network">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <circle cx="5" cy="5" r="2"/>
                    <circle cx="19" cy="5" r="2"/>
                    <circle cx="5" cy="19" r="2"/>
                    <circle cx="19" cy="19" r="2"/>
                    <line x1="12" y1="9" x2="12" y2="12"/>
                    <line x1="9" y1="12" x2="5" y2="7"/>
                    <line x1="15" y1="12" x2="19" y2="7"/>
                    <line x1="9" y1="12" x2="5" y2="17"/>
                    <line x1="15" y1="12" x2="19" y2="17"/>
                </svg>
                Network View
            </button>
            <button class="nav-btn" onclick="switchView('dashboard')" data-view="dashboard">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                Dashboard
            </button>
            <button class="nav-btn" onclick="switchView('executive')" data-view="executive">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
                Executive View
            </button>
        </div>
        
        <div class="upload-section">
            <div class="multi-file-upload">
                <div class="file-upload-group">
                    <label for="existingConnectionsFile">Existing Connections:</label>
                    <input type="file" id="existingConnectionsFile" accept=".xlsx,.xls" />
                    <span class="file-status" id="existingConnectionsStatus">No file selected</span>
                </div>
                <div class="file-upload-group">
                    <label for="targetConnectionsFile">Target Connections (New):</label>
                    <input type="file" id="targetConnectionsFile" accept=".xlsx,.xls" />
                    <span class="file-status" id="targetConnectionsStatus">No file selected</span>
                </div>
                <div class="file-upload-group">
                    <label for="changedConnectionsFile">Changed Connections:</label>
                    <input type="file" id="changedConnectionsFile" accept=".xlsx,.xls" />
                    <span class="file-status" id="changedConnectionsStatus">No file selected</span>
                </div>
            </div>
            <button id="uploadBtn" onclick="handleMultiFileUpload()">Upload and Visualize</button>
        </div>

        <!-- Connection Type Tabs -->
        <div class="connection-tabs" id="connectionTabs" style="display: none;">
            <button class="tab-btn active" onclick="switchConnectionTab('all')" data-tab="all">All Connections</button>
            <button class="tab-btn" onclick="switchConnectionTab('existing')" data-tab="existing">Existing</button>
            <button class="tab-btn" onclick="switchConnectionTab('new')" data-tab="new">New</button>
            <button class="tab-btn" onclick="switchConnectionTab('changed')" data-tab="changed">Changed</button>
        </div>

        <div class="version-section">
            <div class="version-controls">
                <button id="saveVersionBtn" onclick="showSaveVersionDialog()" disabled>Save as Version</button>
                <select id="versionSelect" onchange="handleVersionSelection()" disabled>
                    <option value="">Select a version...</option>
                </select>
                <button id="compareBtn" onclick="showCompareDialog()" disabled>Compare Versions</button>
            </div>
        </div>

        <div class="filter-section" id="filterSection" style="display: none;">
            <div class="filter-controls">
                <label for="commTypeFilter">Filter by Integration Pattern:</label>
                <select id="commTypeFilter" onchange="handleFilterChange()">
                    <option value="all">All Types</option>
                    <option value="batch">Batch</option>
                    <option value="api">Web Service/API</option>
                    <option value="streaming">Streaming/Real-time</option>
                    <option value="file">File Transfer</option>
                    <option value="queue">Messaging/Queue</option>
                    <option value="db">Direct DB Connection</option>
                    <option value="ui">UI Interaction</option>
                    <option value="mixed">Mixed/Hybrid</option>
                </select>
                <label for="frequencyFilter">Filter by Frequency:</label>
                <select id="frequencyFilter" onchange="handleFilterChange()">
                    <option value="all">All Frequencies</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                    <option value="demand">On Demand</option>
                </select>
                <button onclick="resetFilters()">Reset Filters</button>
            </div>
        </div>

        <div id="legend" class="legend" style="display: none;">
            <h3>Legend</h3>
            <div class="legend-section">
                <h4>Integration Pattern</h4>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FF6B6B" stroke-width="4"/>
                    </svg>
                    <span>Direct DB Connection / Batch</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#4ECDC4" stroke-width="3" stroke-dasharray="8,4"/>
                    </svg>
                    <span>Web Service / API</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#95E1D3" stroke-width="3" stroke-dasharray="3,3"/>
                    </svg>
                    <span>Streaming/Real-time</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#AA96DA" stroke-width="3" stroke-dasharray="5,5"/>
                    </svg>
                    <span>File Transfer</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FCBAD3" stroke-width="3" stroke-dasharray="12,3,3,3"/>
                    </svg>
                    <span>Messaging / Message Queue</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FFD93D" stroke-width="3" stroke-dasharray="8,3,2,3"/>
                    </svg>
                    <span>UI Interaction</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#F38181" stroke-width="3" stroke-dasharray="10,5,3,5"/>
                    </svg>
                    <span>Mixed/Hybrid</span>
                </div>
            </div>
            <div class="legend-section">
                <h4>Frequency (fallback if no Integration Pattern)</h4>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#2196F3" stroke-width="3"/>
                    </svg>
                    <span>Daily</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#4CAF50" stroke-width="3" stroke-dasharray="10,5"/>
                    </svg>
                    <span>Weekly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FF9800" stroke-width="3" stroke-dasharray="2,5"/>
                    </svg>
                    <span>Monthly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#9E9E9E" stroke-width="3"/>
                    </svg>
                    <span>Yearly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#E91E63" stroke-width="2"/>
                    </svg>
                    <span>On Demand</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#607D8B" stroke-width="2"/>
                    </svg>
                    <span>Other/Unknown</span>
                </div>
            </div>
        </div>

        <div id="status" class="status"></div>
        
        <div id="network" class="network-container">
            <svg id="networkSvg" width="100%" height="100%"></svg>
        </div>
        
        <!-- Network Stats Footer -->
        <div id="networkStats" class="network-stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="statSystems">0</div>
                <div class="stat-label">Systems</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <div class="stat-value" id="statInterfaces">0</div>
                <div class="stat-label">Interfaces</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <div class="stat-value" id="statTypes">0</div>
                <div class="stat-label">Patterns</div>
            </div>
        </div>

        <!-- Version Save Dialog -->
        <div id="saveVersionDialog" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Save Current Version</h2>
                <label for="versionName">Version Name:</label>
                <input type="text" id="versionName" placeholder="e.g., Version 1.0" />
                <label for="versionDescription">Description (optional):</label>
                <textarea id="versionDescription" placeholder="Describe the changes in this version"></textarea>
                <div class="modal-buttons">
                    <button onclick="saveVersion()">Save</button>
                    <button onclick="closeSaveVersionDialog()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Compare Versions Dialog -->
        <div id="compareDialog" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Compare Versions</h2>
                <label for="baseVersionSelect">Base Version:</label>
                <select id="baseVersionSelect">
                    <option value="">Select base version...</option>
                </select>
                <label for="compareVersionSelect">Compare To:</label>
                <select id="compareVersionSelect">
                    <option value="">Select version to compare...</option>
                </select>
                <div class="modal-buttons">
                    <button onclick="compareVersions()">Compare</button>
                    <button onclick="closeCompareDialog()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Comparison Results -->
        <div id="comparisonResults" class="comparison-results" style="display: none;">
            <h3>Version Comparison</h3>
            <button onclick="closeComparisonResults()" class="close-btn">Close Comparison</button>
            <div id="comparisonSummary"></div>
            <div id="comparisonDetails"></div>
        </div>

        <!-- Summary Insights Dashboard -->
        <div id="dashboardView" class="view-section" style="display: none;">
            <div class="dashboard-header">
                <h2>Summary Insights & Metrics</h2>
                <p class="dashboard-subtitle">Overview of interface data with key performance indicators</p>
            </div>
            
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="kpi-value" id="kpiTotalInterfaces">0</div>
                    <div class="kpi-label">Total Interfaces</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                        </svg>
                    </div>
                    <div class="kpi-value" id="kpiTotalSystems">0</div>
                    <div class="kpi-label">Total Systems</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </div>
                    <div class="kpi-value" id="kpiAvgConnections">0</div>
                    <div class="kpi-label">Avg Connections/System</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <div class="kpi-value" id="kpiValidationScore">100%</div>
                    <div class="kpi-label">Data Quality Score</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Interfaces by Communication Type</h3>
                    <div id="commTypeChart"></div>
                </div>
                <div class="chart-container">
                    <h3>Top 5 Most Connected Systems</h3>
                    <div id="topSystemsChart"></div>
                </div>
                <div class="chart-container">
                    <h3>Interfaces by Frequency</h3>
                    <div id="frequencyChart"></div>
                </div>
                <div class="chart-container">
                    <h3>Data Validation Stats</h3>
                    <div id="validationChart"></div>
                </div>
            </div>

            <!-- Cutover Tasks Section -->
            <div class="cutover-section" id="cutoverSection" style="display: none;">
                <div class="cutover-header">
                    <h3>Cutover Task List</h3>
                    <p class="section-description">Tasks required for migrating new and changed connections</p>
                    <button class="export-btn" onclick="exportCutoverTaskList()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export Task List
                    </button>
                </div>
                <div id="cutoverTaskList" class="cutover-task-list"></div>
            </div>
        </div>

        <!-- Executive Management View -->
        <div id="executiveView" class="view-section" style="display: none;">
            <div class="executive-header">
                <h2>Executive Management View</h2>
                <p class="executive-subtitle">High-level insights for strategic decision-making</p>
                <div class="export-buttons-container">
                    <button class="export-btn" onclick="exportExecutiveReport()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export PDF Report
                    </button>
                    <button class="export-btn pptx-btn" onclick="exportPowerPointReport()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <path d="M12 18v-6"/>
                            <path d="M9 15h6"/>
                        </svg>
                        Export PowerPoint
                    </button>
                </div>
            </div>

            <!-- Executive KPIs -->
            <div class="executive-kpi-grid">
                <div class="executive-kpi-card critical">
                    <div class="kpi-header">
                        <h4>Critical Systems</h4>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <div class="executive-kpi-value" id="execCriticalSystems">0</div>
                    <div class="executive-kpi-label">High-impact systems requiring attention</div>
                </div>
                <div class="executive-kpi-card warning">
                    <div class="kpi-header">
                        <h4>Risk Score</h4>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                    </div>
                    <div class="executive-kpi-value" id="execRiskScore">Low</div>
                    <div class="executive-kpi-label">Overall system dependency risk</div>
                </div>
                <div class="executive-kpi-card info">
                    <div class="kpi-header">
                        <h4>Integration Complexity</h4>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="executive-kpi-value" id="execComplexity">Medium</div>
                    <div class="executive-kpi-label">Based on interface distribution</div>
                </div>
            </div>

            <!-- Critical Path Analysis -->
            <div class="executive-section">
                <h3>Critical Path Systems</h3>
                <p class="section-description">Systems with the highest impact on business operations</p>
                <div id="criticalPathList" class="critical-path-list"></div>
            </div>

            <!-- Risk Impact Matrix -->
            <div class="executive-section">
                <h3>Risk Impact Analysis</h3>
                <p class="section-description">Potential impact of system failures on dependencies</p>
                <div class="risk-matrix-container">
                    <div id="riskImpactChart"></div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="executive-section">
                <h3>Strategic Recommendations</h3>
                <div id="recommendationsList" class="recommendations-list"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
