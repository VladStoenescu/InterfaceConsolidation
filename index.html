<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interface Consolidation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="lib/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Theme Toggle -->
    <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
    </button>
    
    <!-- Loading Spinner -->
    <div class="spinner-backdrop" id="spinnerBackdrop"></div>
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>
    
    <div class="container">
        <div class="header-badge">
            <span class="badge-dot"></span>
            <span>Premium Interface Visualization</span>
        </div>
        <h1>Interface Consolidation Tool</h1>
        <p class="description">Upload an Excel file to visualize system interfaces</p>
        
        <div class="upload-section">
            <input type="file" id="fileInput" accept=".xlsx,.xls" />
            <button id="uploadBtn" onclick="handleFileUpload()">Upload and Visualize</button>
        </div>

        <div class="version-section">
            <div class="version-controls">
                <button id="saveVersionBtn" onclick="showSaveVersionDialog()" disabled>Save as Version</button>
                <select id="versionSelect" onchange="handleVersionSelection()" disabled>
                    <option value="">Select a version...</option>
                </select>
                <button id="compareBtn" onclick="showCompareDialog()" disabled>Compare Versions</button>
            </div>
        </div>

        <div class="filter-section" id="filterSection" style="display: none;">
            <div class="filter-controls">
                <label for="commTypeFilter">Filter by Communication Type:</label>
                <select id="commTypeFilter" onchange="handleFilterChange()">
                    <option value="all">All Types</option>
                    <option value="batch">Batch</option>
                    <option value="api">API/Online</option>
                    <option value="streaming">Streaming/Real-time</option>
                    <option value="file">File Transfer</option>
                    <option value="queue">Message Queue</option>
                    <option value="mixed">Mixed/Hybrid</option>
                </select>
                <label for="frequencyFilter">Filter by Frequency:</label>
                <select id="frequencyFilter" onchange="handleFilterChange()">
                    <option value="all">All Frequencies</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                    <option value="demand">On Demand</option>
                </select>
                <button onclick="resetFilters()">Reset Filters</button>
            </div>
        </div>

        <div id="legend" class="legend" style="display: none;">
            <h3>Legend</h3>
            <div class="legend-section">
                <h4>Communication Type</h4>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FF6B6B" stroke-width="4"/>
                    </svg>
                    <span>Batch</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#4ECDC4" stroke-width="3" stroke-dasharray="8,4"/>
                    </svg>
                    <span>API/Online</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#95E1D3" stroke-width="3" stroke-dasharray="3,3"/>
                    </svg>
                    <span>Streaming/Real-time</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#F38181" stroke-width="3" stroke-dasharray="10,5,3,5"/>
                    </svg>
                    <span>Mixed/Hybrid</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#AA96DA" stroke-width="3" stroke-dasharray="5,5"/>
                    </svg>
                    <span>File Transfer</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FCBAD3" stroke-width="3" stroke-dasharray="12,3,3,3"/>
                    </svg>
                    <span>Message Queue</span>
                </div>
            </div>
            <div class="legend-section">
                <h4>Frequency (fallback if no Communication Type)</h4>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#2196F3" stroke-width="3"/>
                    </svg>
                    <span>Daily</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#4CAF50" stroke-width="3" stroke-dasharray="10,5"/>
                    </svg>
                    <span>Weekly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#FF9800" stroke-width="3" stroke-dasharray="2,5"/>
                    </svg>
                    <span>Monthly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#9E9E9E" stroke-width="3"/>
                    </svg>
                    <span>Yearly</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#E91E63" stroke-width="2"/>
                    </svg>
                    <span>On Demand</span>
                </div>
                <div class="legend-item">
                    <svg width="60" height="4">
                        <line x1="0" y1="2" x2="60" y2="2" stroke="#607D8B" stroke-width="2"/>
                    </svg>
                    <span>Other/Unknown</span>
                </div>
            </div>
        </div>

        <div id="status" class="status"></div>
        
        <div id="network" class="network-container">
            <svg id="networkSvg" width="100%" height="100%"></svg>
        </div>
        
        <!-- Network Stats Footer -->
        <div id="networkStats" class="network-stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="statSystems">0</div>
                <div class="stat-label">Systems</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <div class="stat-value" id="statInterfaces">0</div>
                <div class="stat-label">Interfaces</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <div class="stat-value" id="statTypes">0</div>
                <div class="stat-label">Comm Types</div>
            </div>
        </div>

        <!-- Version Save Dialog -->
        <div id="saveVersionDialog" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Save Current Version</h2>
                <label for="versionName">Version Name:</label>
                <input type="text" id="versionName" placeholder="e.g., Version 1.0" />
                <label for="versionDescription">Description (optional):</label>
                <textarea id="versionDescription" placeholder="Describe the changes in this version"></textarea>
                <div class="modal-buttons">
                    <button onclick="saveVersion()">Save</button>
                    <button onclick="closeSaveVersionDialog()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Compare Versions Dialog -->
        <div id="compareDialog" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Compare Versions</h2>
                <label for="baseVersionSelect">Base Version:</label>
                <select id="baseVersionSelect">
                    <option value="">Select base version...</option>
                </select>
                <label for="compareVersionSelect">Compare To:</label>
                <select id="compareVersionSelect">
                    <option value="">Select version to compare...</option>
                </select>
                <div class="modal-buttons">
                    <button onclick="compareVersions()">Compare</button>
                    <button onclick="closeCompareDialog()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Comparison Results -->
        <div id="comparisonResults" class="comparison-results" style="display: none;">
            <h3>Version Comparison</h3>
            <button onclick="closeComparisonResults()" class="close-btn">Close Comparison</button>
            <div id="comparisonSummary"></div>
            <div id="comparisonDetails"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
